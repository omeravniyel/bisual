<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiSual - YarÄ±ÅŸma OluÅŸtur</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #020617;
            color: white;
        }
    </style>
    <script>
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }
    </script>
</head>

<body class="min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">

    <!-- Background -->
    <div class="absolute inset-0 z-0">
        <div
            class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-indigo-900/40 via-slate-900 to-black">
        </div>
    </div>

    <div class="z-10 w-full max-w-4xl text-center">

        <a href="/host" class="inline-flex items-center gap-2 text-slate-400 hover:text-white mb-8 transition">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            <span>Geri DÃ¶n</span>
        </a>

        <h1
            class="text-4xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-purple-400 mb-4">
            Yeni YarÄ±ÅŸma OluÅŸtur</h1>
        <p class="text-slate-400 text-lg mb-12">Sizin iÃ§in en uygun yÃ¶ntemi seÃ§in.</p>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

            <!-- Manual -->
            <a href="/create"
                class="group bg-slate-800/50 hover:bg-slate-800 border border-slate-700 hover:border-indigo-500 rounded-3xl p-8 transition-all hover:-translate-y-2 cursor-pointer relative overflow-hidden">
                <div class="absolute inset-0 bg-indigo-500/10 opacity-0 group-hover:opacity-100 transition"></div>
                <div
                    class="w-20 h-20 rounded-2xl bg-slate-700 group-hover:bg-indigo-600 flex items-center justify-center mx-auto mb-6 transition shadow-xl">
                    <span class="text-4xl">âœï¸</span>
                </div>
                <h3 class="text-2xl font-bold text-white mb-2">El ile OluÅŸtur</h3>
                <p class="text-slate-400 text-sm">SorularÄ± tek tek kendiniz yazÄ±n.</p>
            </a>

            <!-- AI -->
            <button onclick="document.getElementById('aiModal').showModal()"
                class="group bg-slate-800/50 hover:bg-slate-800 border border-slate-700 hover:border-purple-500 rounded-3xl p-8 transition-all hover:-translate-y-2 cursor-pointer relative overflow-hidden">
                <div class="absolute inset-0 bg-purple-500/10 opacity-0 group-hover:opacity-100 transition"></div>
                <div
                    class="w-20 h-20 rounded-2xl bg-slate-700 group-hover:bg-purple-600 flex items-center justify-center mx-auto mb-6 transition shadow-xl">
                    <span class="text-4xl">âœ¨</span>
                </div>
                <h3 class="text-2xl font-bold text-white mb-2">Yapay Zeka</h3>
                <p class="text-slate-400 text-sm">Konuyu sÃ¶yleyin, AI hazÄ±rlasÄ±n.</p>
            </button>

            <!-- Excel -->
            <button onclick="document.getElementById('excelModal').showModal()"
                class="group bg-slate-800/50 hover:bg-slate-800 border border-slate-700 hover:border-emerald-500 rounded-3xl p-8 transition-all hover:-translate-y-2 cursor-pointer relative overflow-hidden">
                <div class="absolute inset-0 bg-emerald-500/10 opacity-0 group-hover:opacity-100 transition"></div>
                <div
                    class="w-20 h-20 rounded-2xl bg-slate-700 group-hover:bg-emerald-600 flex items-center justify-center mx-auto mb-6 transition shadow-xl">
                    <span class="text-4xl">ğŸ“Š</span>
                </div>
                <h3 class="text-2xl font-bold text-white mb-2">Excel Ä°le YÃ¼kle</h3>
                <p class="text-slate-400 text-sm">Toplu soru listesi yÃ¼kleyin.</p>
            </button>

        </div>
    </div>

    <!-- NATIVE DIALOGS (Robust) -->

    <!-- AI Modal -->
    <dialog id="aiModal"
        class="bg-slate-900 border border-slate-700 rounded-2xl p-0 backdrop:bg-black/80 w-full max-w-lg">
        <div class="p-8 relative"
            x-data="{ aiTopics: ['', '', ''], aiCount: 3, aiDifficulty: 'medium', loading: false }">
            <button onclick="this.closest('dialog').close()"
                class="absolute top-4 right-4 text-slate-500 hover:text-white text-2xl">Ã—</button>
            <h2 class="text-2xl font-bold text-white mb-6">AI YarÄ±ÅŸma SihirbazÄ±</h2>

            <div x-show="loading" class="text-center py-10">
                <div class="text-4xl animate-bounce mb-2">âœ¨</div>
                <p class="text-purple-400 font-bold">Sorular HazÄ±rlanÄ±yor...</p>
            </div>

            <div x-show="!loading" class="space-y-4">

                <div class="flex items-center gap-4 mb-4">
                    <div class="flex-1">
                        <label class="text-xs text-slate-400 font-bold uppercase ml-1">Zorluk</label>
                        <select x-model="aiDifficulty"
                            class="w-full bg-slate-800 border-slate-700 rounded-xl p-3 text-white mt-1">
                            <option value="easy">Kolay</option>
                            <option value="medium">Orta</option>
                            <option value="hard">Zor</option>
                        </select>
                    </div>
                    <div class="w-24">
                        <label class="text-xs text-slate-400 font-bold uppercase ml-1">Soru SayÄ±sÄ±</label>
                        <input type="number" x-model="aiCount" min="1" max="10" @input="
                                // Adjust topics array length immediately
                                let count = parseInt($el.value) || 1;
                                if(count > 10) count = 10;
                                if(count < 1) count = 1;
                                // We don't force update aiCount variable here to avoid interfering with typing,
                                // but we update the array based on the input value.
                                aiTopics = Array.from({length: count}, (_, i) => aiTopics[i] || '');
                            "
                            class="w-full bg-slate-800 border-slate-700 rounded-xl p-3 text-white text-center font-bold mt-1 outline-none focus:border-purple-500">
                    </div>
                </div>

                <div class="max-h-[40vh] overflow-y-auto pr-2 space-y-3 custom-scrollbar">
                    <template x-for="(topic, index) in aiTopics" :key="index">
                        <div class="flex items-center gap-3 animate-in fade-in slide-in-from-bottom-2 duration-300">
                            <span class="text-purple-400 font-bold w-6 text-right" x-text="index + 1 + '.'"></span>
                            <input type="text" x-model="aiTopics[index]" :placeholder="(index + 1) + '. Sorunun konusu'"
                                class="flex-1 bg-slate-800/50 border-slate-700 rounded-lg p-3 text-white outline-none focus:border-purple-500 focus:bg-slate-800 transition">
                        </div>
                    </template>
                </div>

                <button @click="
                    if(aiTopics.some(t => !t.trim())) return alert('LÃ¼tfen tÃ¼m sorular iÃ§in konu giriniz.');
                    loading = true;
                    fetch('/api/ai/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRF-Token': getCookie('csrf_token')
                        },
                        body: JSON.stringify({
                            topics: aiTopics, 
                            count: parseInt(aiCount), 
                            difficulty: aiDifficulty
                        })
                    }).then(res => res.json()).then(data => {
                        if(data.id || data.status === 'success') { window.location.href = '/host'; }
                        else { alert('Hata: ' + (data.detail || 'baÅŸarÄ±sÄ±z')); loading = false; }
                    }).catch(e => { alert('Hata: ' + e); loading = false; })
                "
                    class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:scale-[1.02] transition text-white font-bold py-4 rounded-xl text-lg mt-4 shadow-lg shadow-purple-900/20">
                    ğŸª„ SorularÄ± OluÅŸtur
                </button>
            </div>
        </div>
    </dialog>

    <!-- Excel Modal -->
    <dialog id="excelModal"
        class="bg-slate-900 border border-slate-700 rounded-2xl p-0 backdrop:bg-black/80 w-full max-w-lg">
        <div class="p-8 relative" x-data="{ uploading: false }">
            <button onclick="this.closest('dialog').close()"
                class="absolute top-4 right-4 text-slate-500 hover:text-white text-2xl">Ã—</button>
            <h2 class="text-2xl font-bold text-white mb-6">Excel YÃ¼kle</h2>

            <div class="border-2 border-dashed border-slate-600 hover:border-emerald-500 rounded-2xl p-10 text-center cursor-pointer transition group"
                @click="$refs.fileInput.click()">
                <div class="text-4xl mb-4 group-hover:scale-110 transition">ğŸ“Š</div>
                <p x-show="!uploading" class="text-slate-300 font-bold">Excel DosyasÄ± SeÃ§</p>
                <p x-show="uploading" class="text-emerald-400 font-bold animate-pulse">YÃ¼kleniyor...</p>
                <input type="file" x-ref="fileInput" class="hidden" accept=".xlsx" @change="
                    if(!$event.target.files[0]) return;
                    uploading = true;
                    let fd = new FormData();
                    fd.append('file', $event.target.files[0]);
                    fetch('/api/import/upload', {
                        method:'POST', 
                        headers: { 'X-CSRF-Token': getCookie('csrf_token') },
                        body:fd
                    })
                    .then(r=>r.json())
                    .then(d=>{
                        if(d.questions_count){ alert('TamamlandÄ±!'); window.location.href='/host'; }
                        else { alert('Hata: '+d.detail); uploading=false; }
                    })
                ">
            </div>

            <div class="mt-6 text-center">
                <a href="/api/import/template" class="text-emerald-400 hover:underline">Taslak Excel Ä°ndir</a>
            </div>
        </div>
    </dialog>

</body>

</html>